extends ../layout.pug

block content
  if error
    .card(style="background:#ffe6e6;padding:8px;margin-bottom:8px;color:#900")
      strong Error: 
      |  #{error}
  if task
    h2 Editar tarea
    form(method="POST", action=`/tasks/${task.id}`)
      .row
        .card
          label Título
          input(type="text", name="title", required, value=task?task.title:'')
        .card
          label Descripción
          textarea(name="description")= task?task.description:''
      .row
        .card
          label Área
          select(name="departmentId", required)
            option(value="") -- Seleccionar --
            each d in departments
              if task && task.departmentId === d.id
                option(value=d.id, selected)= d.name
              else
                option(value=d.id)= d.name
        .card
          label Asignado a
          select(name="assigneeId", required)
            option(value="") -- Seleccionar --
            each u in users
              if task && task.assigneeId === u.id
                option(value=u.id, selected)= u.name
              else
                option(value=u.id)= u.name
      .row
        .card
          label Fecha límite
          - const dueDateValue = (task && task.dueDate) ? (typeof task.dueDate === 'string' ? task.dueDate.slice(0,10) : (task.dueDate.toISOString ? task.dueDate.toISOString().slice(0,10) : '')) : ''
          input(type="date", name="dueDate", value=dueDateValue)
        .card
          label Estado
          select(name="status")
            - const statuses = ['pending','in_progress','blocked','done']
            each s in statuses
              if task.status === s
                option(value=s, selected)= s
              else
                option(value=s)= s
      .row
        button(type="submit") Guardar
    form(method="POST", action=`/tasks/${task.id}/delete`, style="display:inline;margin-left:8px")
      button(type="submit") Eliminar
  else
    h2 Nueva tarea
    form(method="POST", action="/tasks")
      .row
        .card
          label Título
          input(type="text", name="title", required, value='')
        .card
          label Descripción
          textarea(name="description")
      .row
        .card
          label Área
          select(name="departmentId", required)
            option(value="") -- Seleccionar --
            each d in departments
              option(value=d.id)= d.name
        .card
          label Asignado a
          select(name="assigneeId", required)
            option(value="") -- Seleccionar --
            each u in users
              option(value=u.id)= u.name
      .row
        .card
          label Fecha límite
          input(type="date", name="dueDate", value='')
      .row
        button(type="submit") Guardar
